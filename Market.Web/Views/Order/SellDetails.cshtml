@model Market.Web.ViewModels.DetailsOrderViewModel

@{
    ViewBag.Title = "Details";
}

@*<div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="page-info">
                    <h2>Заказы</h2>
                    <p class="lead">Здесь отображается информация по заказам</p>
                </div>
                @{Html.RenderAction("AccountMenu", "Account"); }
                <div class="order-details-container">
                    <div class="order-details-head">
                        <h4>Информащия о заказе</h4>
                    </div>
                    <div class="order-details-body">
                        <div class="order-details-row row">
                            <div class="order-details-col col-md-4">
                                <label>Предложение (Оффер)</label>
                            </div>
                            <div class="order-details-col col-md-8">
                                <span>@Html.ActionLink(Model.OfferHeader, "Details", "Offer", new { id = Model.OfferId }, null)</span>
                            </div>
                        </div>
                        <div class="order-details-row row">
                            <div class="order-details-col col-md-4">
                                <label>Покупатель</label>
                            </div>
                            <div class="order-details-col col-md-8">
                                <span></span>
                            </div>
                        </div>
                        <div class="order-details-row row">
                            <div class="order-details-col col-md-4">
                                <label>Статус</label>
                            </div>
                            <div class="order-details-col col-md-8">
                                <span>@Model.OrderStatuses.LastOrDefault().Name</span>
                            </div>
                        </div>
                        <div class="order-details-row row">
                            <div class="order-details-col col-md-4">
                                <label>Цена</label>
                            </div>
                            <div class="order-details-col col-md-8">
                                <span>@Model.OfferPrice</span>
                            </div>
                        </div>
                        <div class="order-details-row row">
                            <div class="order-details-col col-md-5">
                                @if (Model.OrderStatuses.LastOrDefault().Value == "sellerProviding")
                                {
                                    using (Html.BeginForm("ProvideData", "Checkout", null, FormMethod.Get, null))
                                    {
                                        @Html.HiddenFor(m => m.ModeratorId)
                                        @Html.HiddenFor(m => m.Id)
                                        <input type="submit" value="Предоставить данные" />
                                    }

                                }
                                else if ((Model.OrderStatuses.LastOrDefault().Value == "closedSeccessfuly" ||
                                Model.OrderStatuses.LastOrDefault().Value == "payingToSeller") && !Model.BuyerFeedbacked)
                                {
                                    using (Html.BeginForm("GiveToBuyer", "Feedback", null, FormMethod.Get, null))
                                    {
                                        @Html.Hidden("receiverId", Model.BuyerId)
                                        @Html.Hidden("OrderId", Model.Id)

                                        <input type="submit" value="Оставить отзыв покупателю" />
                                    }
                                }
                            </div>
                        </div>
                    </div>

                    @*<div class="row">
                            <div class="col-md-12">
                                @Html.PageLinks(Model.PagingInfo, x => Url.Action("Inbox", new { page = x, sortOrder = ViewBag.CurrentSort, searchString = ViewBag.SearchString }))
                            </div>
                        </div>@
                </div>
            </div>

        </div>
    </div>*@




<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div class="page-info">
                <h2>Заказы</h2>
                <p class="lead">Здесь отображается информация по заказам</p>
            </div>
            @{Html.RenderAction("AccountMenu", "Account"); }
            <div class="account-container bg-white">
                <div style="padding: 20px">
                    <a href="@Request.UrlReferrer"><span style="font-weight: 700">&#10218;</span> <span>Назад</span> </a>
                </div>

                <div class="order-details-head ">
                    <div class="order-details-title">
                        <h4>Информащия о заказе</h4>
                    </div>


                </div>
                <div class="order-details-body">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="alert alert-dismissible alert-warning">
                                <span>Текущий статус заказа: <span class="text-700">@Model.OrderStatuses.LastOrDefault().Name</span></span>
                            </div>
                        </div>
                    </div>
                    <div class="order-details-row row">
                        <div class="order-details-col col-md-4">
                            <label>Предложение (Оффер)</label>
                        </div>
                        <div class="order-details-col col-md-8">
                            <span>@Html.ActionLink(Model.OfferHeader, "Details", "Offer", new { id = Model.OfferId }, null)</span>
                        </div>
                    </div>
                    <div class="order-details-row row">
                        <div class="order-details-col col-md-4">
                            <label>Продавец</label>
                        </div>
                        <div class="order-details-col col-md-8">
                            <span>@Html.ActionLink(Model.BuyerName, "Info", "Profile", new { userName = Model.BuyerName }, null)</span>
                        </div>
                    </div>
                    <div class="order-details-row row">
                        <div class="order-details-col col-md-4">
                            <label>Цена</label>
                        </div>
                        <div class="order-details-col col-md-8">
                            <span>@Model.OfferPrice</span>
                        </div>
                    </div>
                    <div class="order-details-row row">
                        <div class="order-details-col col-md-5">

                            @if (Model.OrderStatuses.Last().Value == "sellerProviding")
                            {
                                using (Html.BeginForm("ProvideData", "Checkout", null, FormMethod.Get, null))
                                {
                                    @Html.HiddenFor(m => m.ModeratorId)
                                    @Html.HiddenFor(m => m.Id)
                                    @Html.HiddenFor(m => m.BuyerId)
                                    @Html.HiddenFor(m => m.SellerId)
                                    <input type="submit" value="Предоставить данные" class="btn btn-provide" />
                                }

                            }
                            else if ((Model.OrderStatuses.Last().Value == "closedSeccessfuly" ||
                            Model.OrderStatuses.Last().Value == "payingToSeller") && !Model.SellerFeedbacked)
                            {
                                using (Html.BeginForm("GiveToBuyer", "Feedback", null, FormMethod.Get, null))
                                {
                                    @Html.Hidden("receiverId", Model.BuyerId)
                                    @Html.Hidden("OrderId", Model.Id)

                                    <input type="submit" value="Оставить отзыв покупателю" class="btn btn-leavefeedback" />
                                }
                            }
                        </div>
                    </div>

                </div>
                <div class="order-details-log-head">
                    <div class="order-details-title">
                        <h4>
                            Журнал событий
                        </h4>
                    </div>


                </div>
                <div class="order-details-log-body">

                    @foreach (var status in Model.OrderStatuses)
                    {

                        <div class="order-details-node">
                            <div class="node-circle"></div>
                            <div class="node-name">@status.FinisedName</div>
                            <div class="node-date">@status.DateFinished</div>
                        </div>

                    }
                </div>
                @*<div class="row">
                        <div class="col-md-12">
                            @Html.PageLinks(Model.PagingInfo, x => Url.Action("Inbox", new { page = x, sortOrder = ViewBag.CurrentSort, searchString = ViewBag.SearchString }))
                        </div>
                    </div>*@
            </div>
        </div>

    </div>
</div>

