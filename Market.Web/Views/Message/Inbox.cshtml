@model Market.Web.ViewModels.MessageListViewModel
@using Microsoft.AspNet.Identity
@{
    ViewBag.Title = "Inbox";

}

@{
    ViewBag.Title = "List";
    var options = new AjaxOptions()
    {

    };
}

<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div class="page-info">
                <h2>Сообщения</h2>
                <p class="lead">Здесь отображается информация по входящим и исходящим сообщениям</p>
            </div>
            @{Html.RenderAction("AccountMenu", "Account"); }
            <div class="account-message-container">
                @{Html.RenderPartial("_AccountMessagesMenu"); }
                @using (Html.BeginForm("Inbox", "Message", null, FormMethod.Get, new { @class = "form-inline form-message-filter" }))
                {


                    <div class="form-message-filter-item">
                        @Html.TextBox("SearchString", ViewBag.CurrentFilter as string, new { @class = "form-control", placeholder = "Поиск..." })
                    </div>

                    <div class="form-message-filter-item">
                        @Html.TextBox("SenderName", ViewBag.SenderName as string, new { @class = "form-control", placeholder = "От кого:" })
                    </div>







                    var filterList = new List<SelectListItem>() {
                        new SelectListItem()
                        {
                            Text = "Все",
                            Value = "all",
                            Selected = true
                        },
                        new SelectListItem()
                        {
                            Text = "Прочитанные",
                            Value = "read"
                        },
                        new SelectListItem()
                        {
                            Text = "Непрочитанные",
                            Value = "unread"
                        }
                    };
                    <div class="form-message-filter-item">
                        @Html.DropDownList("CurrentFilter", filterList, new { @class = "form-control" })
                    </div>


                    <input type="submit" value="Поиск" class="btn btn-info" />




                }

                <table class="table table-white" id="messages">
                    <tr>
                        <th></th>
                        <th>@Html.ActionLink("Отправитель", "Inbox", "Message", new { sortOrder = ViewData["NameSortParm"], currentFilter = ViewData["SearchString"] }, null)</th>
                        <th>Сообщение</th>
                        <th class="date-table">@Html.ActionLink("Дата", "Inbox", "Message", new { sortOrder = ViewData["DateSortParm"], currentFilter = ViewData["SearchString"] }, null)</th>
                        <th></th>
                    </tr>
                    @foreach (var messageGroup in Model.Messages)
                    {

                        var clsBold = "";
                        if (!messageGroup.IsViewed)
                        {
                            clsBold = "font-weight-bold";
                        }

                        <tr id="message-row-@messageGroup.Id" class="@clsBold">
                            <td class="set-viewed-td">
                                @if (!messageGroup.IsViewed)
                                {
                                    <a class="set-viewed-link"><div data-id="@messageGroup.Id" class="set-viewed-icon"></div></a>

                                }
                            </td>
                            <td class="clickable sender-table" data-id="@messageGroup.Id"><img class="img-circle avatar-small" src="@Url.Action("Photo", "Profile", new { UserId = messageGroup.SenderId })" alt="Alternate Text" />@messageGroup.SenderName</td>
                            <td class="clickable" id="@messageGroup.Id" data-id="@messageGroup.Id" style=" max-width: 100px;overflow: hidden;text-overflow: ellipsis; white-space: nowrap; "><span style="">@messageGroup.MessageBody</span></td>
                            @*<td>@messageGroup.</td>*@
                            <td class="clickable date-table" data-id="@messageGroup.Id" title="@messageGroup.CreatedDate.ToShortTimeString()">@messageGroup.CreatedDate.ToShortDateString()</td>

                            <td class="remove-table"><a data-id="@messageGroup.Id" id="linkdelete" class="remove-link"><img src="~/Content/Images/trash.png" class="remove-icon" /></a></td>
                            @*<td style="color:red">@Html.ActionLink("X", "DeleteStory", new { lastMessageId = messageGroup.FirstOrDefault().Id}, null)</td>*@
                        </tr>

                    }
                </table>

                @*<div class="row">
                        <div class="col-md-12">
                            @Html.PageLinks(Model.PagingInfo, x => Url.Action("Inbox", new { page = x, sortOrder = ViewBag.CurrentSort, searchString = ViewBag.SearchString }))
                        </div>
                    </div>*@
            </div>
        </div>

    </div>
</div>
@section scripts
{
    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
    <script type="text/javascript" src="~/Scripts/jquery-messages.js"></script>

}